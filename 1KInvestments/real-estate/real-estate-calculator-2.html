<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>OPA Street Address Search</title>
</head>
<body>
  <h2>Philadelphia Address Lookup</h2>
  <input id="input" placeholder="e.g. 635 N 67TH ST">
  <button onclick="search()">Search</button>
  <pre id="output">Waiting...</pre>

  <script>
    async function search() {
      const input = document.getElementById("input").value.trim().toUpperCase();
      const output = document.getElementById("output");
      if (input.length < 3) {
        output.textContent = "Enter at least 3 characters.";
        return;
      }

      const query = `SELECT street_address FROM opa_properties_public WHERE street_address ILIKE '%${input.replace(/'/g, "''")}%' LIMIT 10`;
      const url = `https://phl.carto.com/api/v2/sql?q=${encodeURIComponent(query)}`;

      output.textContent = `Fetching...\n${url}`;

      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        if (data.rows.length === 0) {
          output.textContent = "No matches found.";
        } else {
          output.textContent = "Matches:\n" + data.rows.map(r => r.street_address).join("\n");
        }
      } catch (err) {
        output.textContent = "Fetch failed:\n" + err.message;
      }
    }
  </script>
</body>
</html>
